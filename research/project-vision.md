# Dart-ACDC-generator Generator - Project Vision

## The Problem

When building production Flutter apps that consume REST APIs, developers face a gap:

1. **OpenAPI Generator** creates basic API clients from OpenAPI specs
2. **Production apps** need authentication, caching, offline support, logging, error handling
3. **Dart-ACDC** provides these features but requires manual integration

Current workflow:
```
OpenAPI Spec â†’ Generate Client â†’ Manual Integration with Dart-ACDC â†’ Production App
                                  â†‘
                                  Time-consuming, error-prone
```

## The Opportunity

Create a custom OpenAPI Generator for Dart that **automatically generates clients integrated with Dart-ACDC**, eliminating manual integration work.

Ideal workflow:
```
OpenAPI Spec â†’ Generate ACDC-Integrated Client â†’ Production App
                â†‘
                Automatic, consistent, production-ready
```

## What is Dart-ACDC?

**Dart-ACDC** is a production-ready HTTP client wrapper for Flutter that provides:

### The Four Pillars (ACDC)

1. **Authentication (A)**
   - OAuth 2.1 with automatic token refresh
   - Secure token storage (Keychain/EncryptedSharedPreferences)
   - Request queuing during refresh

2. **Caching (C)**
   - Two-tier caching (Memory + Disk)
   - User isolation (cache keys include user ID)
   - HTTP standard compliance
   - AES-256 encryption

3. **Debugging (D)**
   - Configurable logging levels
   - Automatic sensitive data redaction
   - Crash reporting integration

4. **Client (C)**
   - Request deduplication
   - Certificate pinning
   - Type-safe error handling
   - Offline support

### Why It Matters

- **Zero-config**: Works out of the box with sensible defaults
- **Production-ready**: Security, offline support, error handling built-in
- **Type-safe**: Full null safety and typed exceptions
- **Testable**: Easy mocking for unit tests
- **Efficient**: Request deduplication reduces bandwidth

## What is OpenAPI Generator?

**OpenAPI Generator** is a tool that automatically generates code from OpenAPI specifications:

- **50+ client generators** across multiple languages
- **40+ server generators** for backend development
- **Mustache-based templates** for customization
- **Extensible architecture** for custom generators

### How It Works

1. Reads OpenAPI specification (YAML/JSON)
2. Creates normalized data structure
3. Applies Mustache templates
4. Generates code (clients, servers, docs)

### Creating Custom Generators

Two approaches:

#### 1. Bootstrap Script (Recommended)
```bash
./new.sh -n dart-acdC-generator -c -t
```

Creates:
- Java Codegen class
- Template directory
- Test files

#### 2. Meta Command
```bash
java -jar openapi-generator-cli.jar meta \
  -o out/generators/dart-acdC-generator \
  -n dart-acdC-generator \
  -p com.acdc.codegen
```

### Required Components

1. **Codegen Class** (Java)
   - Extends `DefaultCodegen`
   - Defines type mappings, packages, options
   - Customizes code generation behavior

2. **Mustache Templates**
   - `api.mustache` - API endpoint classes
   - `model.mustache` - Data model classes
   - `pubspec.mustache` - Package configuration
   - Supporting files (README, etc.)

3. **SPI Registration**
   - Register in `META-INF/services/org.openapitools.codegen.CodegenConfig`

4. **Config Files**
   - Example configurations in `./bin/configs/`

## The Dart-ACDC-generator Generator Vision

### What is "FAST"?

**FAST** stands for **F**ully **A**utomated **S**etup and **T**emplating

### Goals

Create an OpenAPI Generator that produces Dart clients with:

1. âœ… **Dart-ACDC integration out of the box**
2. âœ… **Production-ready code** (not just scaffolding)
3. âœ… **Type-safe error handling**
4. âœ… **Authentication built-in**
5. âœ… **Offline support and caching**
6. âœ… **Proper Dart/Flutter conventions**
7. âœ… **Comprehensive documentation**

### Generated Code Example

```dart
// Generated by dart-acdC-generator generator

import 'package:dart_acdc/dart_acdc.dart';
import 'package:dio/dio.dart';

class UserApi {
  final Dio _dio;

  UserApi(this._dio);

  /// Get user by ID
  /// Throws: AcdcAuthException, AcdcNetworkException, AcdcServerException
  Future<User> getUser(String userId) async {
    try {
      final response = await _dio.get('/users/$userId');
      return User.fromJson(response.data);
    } on DioException catch (e) {
      // Automatically converted to typed ACDC exceptions
      throw AcdcException.fromDioException(e);
    }
  }

  // More methods...
}

// Main configuration
class ApiClient {
  static Dio createDio({
    required String baseUrl,
    String? tokenRefreshUrl,
    LogLevel logLevel = LogLevel.info,
  }) {
    return AcdcClientBuilder()
      .withBaseUrl(baseUrl)
      .withAuthentication(
        tokenRefreshUrl: tokenRefreshUrl ?? '$baseUrl/auth/refresh',
      )
      .withCache(ttl: Duration(hours: 1))
      .withLogging(level: logLevel)
      .withOfflineDetection(failFast: true)
      .build();
  }
}
```

### Key Features to Generate

#### 1. API Classes
- Methods for each endpoint
- Proper parameter handling
- Type-safe responses
- ACDC exception wrapping

#### 2. Model Classes
- JSON serialization (json_serializable)
- Null safety
- Freezed support (optional)
- Documentation from OpenAPI schema

#### 3. Configuration
- `ApiClient` helper class
- Pre-configured `AcdcClientBuilder` setup
- Environment-specific configurations

#### 4. Documentation
- README with setup instructions
- Authentication guide
- Example usage
- Error handling guide

#### 5. Supporting Files
- `pubspec.yaml` with all dependencies
- `analysis_options.yaml` for linting
- `.openapi-generator-ignore`
- Build runner configuration

### Generator Options

Configurable through CLI or config file:

```yaml
generatorName: dart-acdC-generator
additionalProperties:
  # Package info
  pubName: my_api_client
  pubVersion: 1.0.0
  pubDescription: "API client for My Service"
  pubAuthor: "Your Name"

  # Dart-ACDC features
  enableAuthentication: true
  enableCaching: true
  enableOfflineSupport: true
  enableCertificatePinning: false

  # Code generation options
  useJsonSerializable: true
  useFreezed: false
  nullSafety: true

  # Authentication config
  defaultTokenRefreshUrl: "/auth/refresh"
  useSecureTokenProvider: true

  # Caching config
  defaultCacheTtl: "1h"
  encryptCache: true

  # Logging
  defaultLogLevel: "info"
  redactSensitiveData: true
```

### Template Structure

```
dart-acdC-generator/
â”œâ”€â”€ api.mustache                    # API class template
â”œâ”€â”€ model.mustache                  # Model class template
â”œâ”€â”€ api_client.mustache             # Main client configuration
â”œâ”€â”€ pubspec.mustache                # Package configuration
â”œâ”€â”€ README.mustache                 # Documentation
â”œâ”€â”€ analysis_options.mustache       # Linting configuration
â”œâ”€â”€ gitignore.mustache             # Git ignore file
â””â”€â”€ libraries/
    â”œâ”€â”€ json_serializable/          # JSON serializable templates
    â”‚   â”œâ”€â”€ model.mustache
    â”‚   â””â”€â”€ serializers.mustache
    â””â”€â”€ freezed/                    # Freezed templates (optional)
        â””â”€â”€ model.mustache
```

### Mustache Variable Mapping

Key variables available in templates:

**Package Level**:
- `{{pubName}}` - Package name
- `{{pubVersion}}` - Version
- `{{pubDescription}}` - Description
- `{{apiVersion}}` - API version from spec

**API Level**:
- `{{classname}}` - API class name (e.g., UserApi)
- `{{operations}}` - List of operations
- `{{basePath}}` - API base path

**Operation Level**:
- `{{operationId}}` - Method name
- `{{httpMethod}}` - GET, POST, etc.
- `{{path}}` - Endpoint path
- `{{returnType}}` - Return type
- `{{summary}}` - Operation summary
- `{{notes}}` - Detailed description
- `{{allParams}}` - All parameters

**Model Level**:
- `{{classname}}` - Model class name
- `{{vars}}` - List of properties
- `{{description}}` - Model description
- `{{imports}}` - Required imports

### Type Mappings

OpenAPI types to Dart types:

```java
typeMapping.put("integer", "int");
typeMapping.put("long", "int");
typeMapping.put("number", "double");
typeMapping.put("float", "double");
typeMapping.put("boolean", "bool");
typeMapping.put("string", "String");
typeMapping.put("date", "DateTime");
typeMapping.put("DateTime", "DateTime");
typeMapping.put("password", "String");
typeMapping.put("array", "List");
typeMapping.put("map", "Map<String, dynamic>");
typeMapping.put("object", "Object");
```

### Integration Workflow

#### For Developers Using the Generator

1. **Generate the client**:
```bash
openapi-generator generate \
  -g dart-acdC-generator \
  -i openapi.yaml \
  -o ./lib/api_client \
  --additional-properties pubName=my_api_client
```

2. **Add to pubspec.yaml** (auto-generated):
```yaml
dependencies:
  dart_acdc: ^0.2.0
  dio: ^5.0.0
  json_annotation: ^4.8.0
  # ... other dependencies
```

3. **Initialize the client**:
```dart
import 'package:my_api_client/api_client.dart';

void main() {
  final dio = ApiClient.createDio(
    baseUrl: 'https://api.example.com',
    logLevel: LogLevel.debug,
  );

  final userApi = UserApi(dio);
  // Use the API
}
```

4. **Handle authentication**:
```dart
// Login
final authManager = dio.getAcdcAuthManager();
await authManager.withInitialTokens(
  accessToken: loginResponse.accessToken,
  refreshToken: loginResponse.refreshToken,
);

// Logout
await authManager.logout(revokeOnServer: true);
```

5. **Handle errors**:
```dart
try {
  final user = await userApi.getUser('123');
} on AcdcAuthException {
  navigateToLogin();
} on AcdcNetworkException {
  showOfflineMessage();
} on AcdcServerException catch (e) {
  showError('Server error: ${e.message}');
}
```

### Benefits

#### For App Developers

1. **Instant production-ready code**
   - No manual integration needed
   - Best practices built-in
   - Consistent across projects

2. **Type safety**
   - Compile-time error checking
   - IDE autocomplete
   - Refactoring support

3. **Reduced boilerplate**
   - Authentication handled automatically
   - Error handling standardized
   - Caching configured out of the box

4. **Better UX**
   - Offline support
   - Fast responses (caching)
   - Graceful error handling

5. **Maintainability**
   - Regenerate when API changes
   - Consistent code structure
   - Well-documented

#### For Teams

1. **Consistency**
   - Same patterns across all apps
   - Shared knowledge
   - Easy code reviews

2. **Faster development**
   - No reinventing the wheel
   - Less time on infrastructure
   - More time on features

3. **Quality**
   - Security built-in
   - Tested patterns
   - Production-ready from day one

## Technical Approach

### Phase 1: Study & Research âœ…

- [x] Study OpenAPI Generator architecture
- [x] Study Dart-ACDC library
- [x] Understand dart-dio generator
- [x] Document findings

### Phase 2: Generator Development

1. **Bootstrap the generator**
   ```bash
   cd openapi-generator
   ./new.sh -n dart-acdC-generator -c -t
   ```

2. **Implement Codegen class**
   - Extend `DefaultCodegen` or `DartDioClientCodegen`
   - Configure type mappings
   - Add custom options for ACDC features
   - Override methods for Dart-specific behavior

3. **Create Mustache templates**
   - `api.mustache` with ACDC integration
   - `model.mustache` with json_serializable
   - `api_client.mustache` for configuration
   - `pubspec.mustache` with dependencies
   - Supporting documentation templates

4. **Register the generator**
   - Add to SPI configuration
   - Create example config files

5. **Test with Petstore**
   ```bash
   ./bin/generate-samples.sh ./bin/configs/dart-acdC-generator-petstore.yaml
   cd samples/client/petstore/dart-acdC-generator
   dart analyze
   dart test
   ```

### Phase 3: Refinement

1. **Add generator options**
   - Authentication configuration
   - Caching options
   - Logging preferences
   - Serialization library choice

2. **Improve templates**
   - Better documentation
   - More examples
   - Edge case handling

3. **Add tests**
   - Unit tests for Codegen class
   - Integration tests with real specs
   - Generated code tests

### Phase 4: Documentation

1. **Usage guide**
   - Installation instructions
   - Configuration options
   - Examples

2. **Developer guide**
   - Template customization
   - Contributing guidelines
   - Architecture overview

3. **Migration guide**
   - From dart-dio generator
   - From manual Dart-ACDC integration

### Phase 5: Distribution

1. **Contribute to OpenAPI Generator**
   - Submit PR to main repository
   - Or maintain as separate fork

2. **Package the generator**
   - Standalone JAR
   - Docker image
   - NPM package

3. **Publish documentation**
   - GitHub Pages
   - README
   - Examples repository

## Challenges & Solutions

### Challenge 1: Complexity

**Problem**: Integrating all ACDC features might be complex

**Solution**:
- Start with minimal viable generator
- Add features incrementally
- Make features optional via configuration

### Challenge 2: Maintenance

**Problem**: Keeping up with OpenAPI Generator and Dart-ACDC updates

**Solution**:
- Extend existing dart-dio generator where possible
- Follow semantic versioning
- Automated testing with CI/CD

### Challenge 3: Customization

**Problem**: Different apps have different needs

**Solution**:
- Provide extensive configuration options
- Allow template overrides
- Document customization process

### Challenge 4: Learning Curve

**Problem**: Developers need to understand both OpenAPI and ACDC

**Solution**:
- Comprehensive documentation
- Example projects
- Video tutorials
- Default configurations that "just work"

## Success Metrics

1. **Adoption**: Number of projects using the generator
2. **Time saved**: Reduction in integration time vs manual approach
3. **Code quality**: Generated code passes linting, has no security issues
4. **Developer satisfaction**: Positive feedback, contributions
5. **Maintenance**: Issues resolved quickly, generator stays up to date

## Conclusion

The **Dart-ACDC-generator Generator** bridges the gap between OpenAPI specification and production-ready Flutter apps by combining:

- **OpenAPI Generator's** code generation capabilities
- **Dart-ACDC's** production-ready HTTP client features
- **Best practices** for Flutter/Dart development

This results in:
- âš¡ Faster development
- ðŸ”’ Better security
- ðŸ“± Better UX (offline, caching)
- ðŸŽ¯ Type safety
- ðŸ§ª Easier testing
- ðŸ“š Better documentation

The generator will save developers hours of manual integration work while ensuring consistent, high-quality, production-ready code.

## Next Steps

1. Set up OpenAPI Generator development environment
2. Create initial generator structure using `new.sh`
3. Implement basic templates for API and models
4. Test with Petstore OpenAPI spec
5. Iterate and refine based on results
6. Document and share

---

**Vision**: Make Flutter API client development as simple as writing an OpenAPI spec.

**Mission**: Automatically generate production-ready, fully-integrated Dart API clients that developers can use immediately in their apps.

**Value**: Time saved, quality improved, best practices enforced, consistency achieved.
