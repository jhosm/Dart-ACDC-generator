{{#operations}}
// AUTO-GENERATED FILE - DO NOT EDIT
import 'package:test/test.dart';
import 'package:dio/dio.dart';
import 'package:{{pubName}}/remote_data_sources/{{classFilename}}_remote_data_source_impl.dart';
{{#imports}}
import '{{.}}';
{{/imports}}
import 'test_helpers.dart';

void main() {
  group('{{classname}}RemoteDataSource tests', () {
{{#operation}}
    group('{{operationId}} tests', () {
      test('success case - returns {{#returnType}}{{{returnType}}}{{/returnType}}{{^returnType}}void{{/returnType}}', () async {
        // Arrange
        final mockSetup = createMockDio();
        final api = {{classname}}RemoteDataSourceImpl(mockSetup.dio);
{{#returnType}}
{{#isArray}}

        final responseData = {{{sampleResponseJson}}};

        mockSetup.adapter.on{{httpMethodCapitalized}}List('{{path}}'{{#pathParams}}.replaceAll('{{{baseName}}}', 'test_{{paramName}}'){{/pathParams}}, responseData);
{{/isArray}}
{{^isArray}}
{{#returnTypeIsPrimitive}}

        final responseData = {{{sampleResponseJson}}};

        mockSetup.adapter.on{{httpMethodCapitalized}}(
          '{{path}}'{{#pathParams}}.replaceAll('{{{baseName}}}', 'test_{{paramName}}'){{/pathParams}},
          (RequestOptions server) => server.reply(200, responseData),
        );
{{/returnTypeIsPrimitive}}
{{^returnTypeIsPrimitive}}

        final responseData = {{{sampleResponseJson}}};

        mockSetup.adapter.on{{httpMethodCapitalized}}Json('{{path}}'{{#pathParams}}.replaceAll('{{{baseName}}}', 'test_{{paramName}}'){{/pathParams}}, responseData);
{{/returnTypeIsPrimitive}}
{{/isArray}}
{{/returnType}}
{{^returnType}}

        mockSetup.adapter.on{{httpMethodCapitalized}}(
          '{{path}}'{{#pathParams}}.replaceAll('{{{baseName}}}', 'test_{{paramName}}'){{/pathParams}},
          (RequestOptions server) => server.reply(204, null),
        );
{{/returnType}}

        // Act
        final result = await api.{{operationId}}({{#allParams}}{{^-first}}, {{/-first}}{{#isPathParam}}'test_{{paramName}}'{{/isPathParam}}{{#isBodyParam}}{{{testValue}}}{{/isBodyParam}}{{#isQueryParam}}{{paramName}}: {{#isString}}'test_{{paramName}}'{{/isString}}{{#isInteger}}42{{/isInteger}}{{#isLong}}42{{/isLong}}{{#isDouble}}3.14{{/isDouble}}{{#isFloat}}3.14{{/isFloat}}{{#isBoolean}}true{{/isBoolean}}{{/isQueryParam}}{{#isHeaderParam}}{{paramName}}: 'test_{{paramName}}'{{/isHeaderParam}}{{#isFormParam}}{{#isString}}'test_{{paramName}}'{{/isString}}{{#isInteger}}42{{/isInteger}}{{#isBoolean}}true{{/isBoolean}}{{/isFormParam}}{{/allParams}});

        // Assert
{{#returnType}}
{{#isArray}}
        expect(result, isA<List<{{{returnBaseType}}}>>());
        expect(result.length, equals(1));
{{/isArray}}
{{^isArray}}
{{#returnTypeIsPrimitive}}
        expect(result, equals(responseData));
{{/returnTypeIsPrimitive}}
{{^returnTypeIsPrimitive}}
        expect(result, isA<{{{returnType}}}>());
{{/returnTypeIsPrimitive}}
{{/isArray}}
{{/returnType}}
{{^returnType}}
        // No assertion needed for void return
{{/returnType}}
      });
{{#hasPathParams}}

      test('path parameters are correctly substituted', () async {
        // Arrange
        final mockSetup = createMockDio();
        final api = {{classname}}RemoteDataSourceImpl(mockSetup.dio);

        String capturedPath = '';
        mockSetup.adapter.on{{httpMethodCapitalized}}(
          '{{path}}'{{#pathParams}}.replaceAll('{{{baseName}}}', 'param_value_{{paramName}}'){{/pathParams}},
          (RequestOptions server) {
            capturedPath = server.request.uri.path;
            return server.reply({{#returnType}}200{{/returnType}}{{^returnType}}204{{/returnType}}, {{#returnType}}{{#isArray}}[]{{/isArray}}{{^isArray}}{{#returnTypeIsPrimitive}}{{#isString}}''{{/isString}}{{#isInteger}}0{{/isInteger}}{{#isLong}}0{{/isLong}}{{#isDouble}}0.0{{/isDouble}}{{#isFloat}}0.0{{/isFloat}}{{#isBoolean}}false{{/isBoolean}}{{/returnTypeIsPrimitive}}{{^returnTypeIsPrimitive}}<String, dynamic>{}{{/returnTypeIsPrimitive}}{{/isArray}}{{/returnType}}{{^returnType}}null{{/returnType}});
          },
        );

        // Act
        await api.{{operationId}}({{#allParams}}{{^-first}}, {{/-first}}{{#isPathParam}}'param_value_{{paramName}}'{{/isPathParam}}{{#isBodyParam}}{{{testValue}}}{{/isBodyParam}}{{#isQueryParam}}{{paramName}}: {{#isString}}'test'{{/isString}}{{#isInteger}}0{{/isInteger}}{{#isLong}}0{{/isLong}}{{#isDouble}}0.0{{/isDouble}}{{#isFloat}}0.0{{/isFloat}}{{#isBoolean}}false{{/isBoolean}}{{/isQueryParam}}{{#isHeaderParam}}{{paramName}}: 'test'{{/isHeaderParam}}{{#isFormParam}}{{#isString}}'test'{{/isString}}{{#isInteger}}0{{/isInteger}}{{#isBoolean}}false{{/isBoolean}}{{/isFormParam}}{{/allParams}});

        // Assert
        expect(capturedPath, contains('param_value'));
{{#pathParams}}
        expect(capturedPath, contains('param_value_{{paramName}}'));
{{/pathParams}}
      });
{{/hasPathParams}}
{{#hasQueryParams}}

      test('query parameters are correctly constructed', () async {
        // Arrange
        final mockSetup = createMockDio();
        final api = {{classname}}RemoteDataSourceImpl(mockSetup.dio);

        Map<String, dynamic> capturedQueryParams = {};
        mockSetup.adapter.on{{httpMethodCapitalized}}(
          '{{path}}'{{#pathParams}}.replaceAll('{{{baseName}}}', 'test_{{paramName}}'){{/pathParams}},
          (RequestOptions server) {
            capturedQueryParams = Map.from(server.request.uri.queryParameters);
            return server.reply({{#returnType}}200{{/returnType}}{{^returnType}}204{{/returnType}}, {{#returnType}}{{#isArray}}[]{{/isArray}}{{^isArray}}{{#returnTypeIsPrimitive}}{{#isString}}''{{/isString}}{{#isInteger}}0{{/isInteger}}{{#isLong}}0{{/isLong}}{{#isDouble}}0.0{{/isDouble}}{{#isFloat}}0.0{{/isFloat}}{{#isBoolean}}false{{/isBoolean}}{{/returnTypeIsPrimitive}}{{^returnTypeIsPrimitive}}<String, dynamic>{}{{/returnTypeIsPrimitive}}{{/isArray}}{{/returnType}}{{^returnType}}null{{/returnType}});
          },
        );

        // Act
        await api.{{operationId}}({{#allParams}}{{^-first}}, {{/-first}}{{#isPathParam}}'test_{{paramName}}'{{/isPathParam}}{{#isBodyParam}}{{{testValue}}}{{/isBodyParam}}{{#isQueryParam}}{{paramName}}: {{#isString}}'query_value_{{paramName}}'{{/isString}}{{#isInteger}}123{{/isInteger}}{{#isLong}}123{{/isLong}}{{#isDouble}}1.23{{/isDouble}}{{#isFloat}}1.23{{/isFloat}}{{#isBoolean}}true{{/isBoolean}}{{/isQueryParam}}{{#isHeaderParam}}{{paramName}}: 'test'{{/isHeaderParam}}{{#isFormParam}}{{#isString}}'test'{{/isString}}{{#isInteger}}0{{/isInteger}}{{#isBoolean}}false{{/isBoolean}}{{/isFormParam}}{{/allParams}});

        // Assert
{{#queryParams}}
        expect(capturedQueryParams.containsKey('{{baseName}}'), isTrue);
{{/queryParams}}
      });
{{/hasQueryParams}}

      test('server error throws exception', () async {
        // Arrange
        final mockSetup = createMockDio();
        final api = {{classname}}RemoteDataSourceImpl(mockSetup.dio);

        mockSetup.adapter.onGetError('{{path}}'{{#pathParams}}.replaceAll('{{{baseName}}}', 'test_{{paramName}}'){{/pathParams}}, statusCode: 500);

        // Act & Assert
        expect(
          () => api.{{operationId}}({{#allParams}}{{^-first}}, {{/-first}}{{#isPathParam}}'test_{{paramName}}'{{/isPathParam}}{{#isBodyParam}}{{{testValue}}}{{/isBodyParam}}{{#isQueryParam}}{{paramName}}: {{#isString}}'test'{{/isString}}{{#isInteger}}0{{/isInteger}}{{#isLong}}0{{/isLong}}{{#isDouble}}0.0{{/isDouble}}{{#isFloat}}0.0{{/isFloat}}{{#isBoolean}}false{{/isBoolean}}{{/isQueryParam}}{{#isHeaderParam}}{{paramName}}: 'test'{{/isHeaderParam}}{{#isFormParam}}{{#isString}}'test'{{/isString}}{{#isInteger}}0{{/isInteger}}{{#isBoolean}}false{{/isBoolean}}{{/isFormParam}}{{/allParams}}),
          throwsA(isA<DioException>()),
        );
      });
    });

{{/operation}}
  });
}
{{/operations}}
