{{#operations}}
// AUTO-GENERATED FILE - DO NOT EDIT
import 'package:test/test.dart';
import 'package:dio/dio.dart';
import 'package:{{pubName}}/remote_data_sources/{{classFilename}}_remote_data_source_impl.dart';
{{#imports}}
import '{{.}}';
{{/imports}}
import 'test_helpers.dart';

void main() {
  group('{{classname}}RemoteDataSource tests', () {
{{#operation}}
    group('{{operationId}} tests', () {
      test('success case - returns {{#returnType}}{{{returnType}}}{{/returnType}}{{^returnType}}void{{/returnType}}', () async {
        // Arrange
        final mockSetup = createMockDio();
        final api = {{classname}}RemoteDataSourceImpl(mockSetup.dio);
{{#returnType}}
{{#isArray}}

        final responseData = {{{vendorExtensions.sampleResponseJson}}};

        mockSetup.adapter.on{{vendorExtensions.httpMethodCapitalized}}List('{{path}}'{{#pathParams}}.replaceAll('{{{baseName}}}', '{{vendorExtensions.testValueRaw}}'){{/pathParams}}, responseData);
{{/isArray}}
{{^isArray}}
{{#returnTypeIsPrimitive}}

        final responseData = {{{vendorExtensions.sampleResponseJson}}};

        mockSetup.adapter.on{{vendorExtensions.httpMethodCapitalized}}(
          '{{path}}'{{#pathParams}}.replaceAll('{{{baseName}}}', '{{vendorExtensions.testValueRaw}}'){{/pathParams}},
          (server) => server.reply(200, responseData),
        );
{{/returnTypeIsPrimitive}}
{{^returnTypeIsPrimitive}}

        final responseData = {{{vendorExtensions.sampleResponseJson}}};

        mockSetup.adapter.on{{vendorExtensions.httpMethodCapitalized}}Json('{{path}}'{{#pathParams}}.replaceAll('{{{baseName}}}', '{{vendorExtensions.testValueRaw}}'){{/pathParams}}, responseData);
{{/returnTypeIsPrimitive}}
{{/isArray}}
{{/returnType}}
{{^returnType}}

        mockSetup.adapter.on{{vendorExtensions.httpMethodCapitalized}}(
          '{{path}}'{{#pathParams}}.replaceAll('{{{baseName}}}', '{{vendorExtensions.testValueRaw}}'){{/pathParams}},
          (server) => server.reply(204, null),
        );
{{/returnType}}

        // Act
        {{#returnType}}final result = {{/returnType}}await api.{{operationId}}({{#allParams}}{{^-first}}, {{/-first}}{{#isPathParam}}{{{vendorExtensions.testValue}}}{{/isPathParam}}{{#isBodyParam}}{{{vendorExtensions.testValue}}}{{/isBodyParam}}{{#isQueryParam}}{{{vendorExtensions.testValue}}}{{/isQueryParam}}{{#isHeaderParam}}{{{vendorExtensions.testValue}}}{{/isHeaderParam}}{{#isFormParam}}{{{vendorExtensions.testValue}}}{{/isFormParam}}{{/allParams}});

        // Assert
{{#returnType}}
{{#isArray}}
        expect(result, isA<List<{{{returnBaseType}}}>>());
        expect(result.length, equals(1));
{{/isArray}}
{{^isArray}}
{{#returnTypeIsPrimitive}}
        expect(result, equals(responseData));
{{/returnTypeIsPrimitive}}
{{^returnTypeIsPrimitive}}
        expect(result, isA<{{{returnType}}}>());
{{/returnTypeIsPrimitive}}
{{/isArray}}
{{/returnType}}
      });
{{#hasPathParams}}

      test('path parameters are correctly substituted', () async {
        // Arrange
        final mockSetup = createMockDio();
        final api = {{classname}}RemoteDataSourceImpl(mockSetup.dio);

        // The mock adapter matches the exact path, so a successful response
        // verifies that path parameters were correctly substituted
        mockSetup.adapter.on{{vendorExtensions.httpMethodCapitalized}}(
          '{{path}}'{{#pathParams}}.replaceAll('{{{baseName}}}', '{{vendorExtensions.testValueRaw}}'){{/pathParams}},
          (server) => server.reply({{#returnType}}200{{/returnType}}{{^returnType}}204{{/returnType}}, {{#returnType}}{{#isArray}}<dynamic>[]{{/isArray}}{{^isArray}}{{#returnTypeIsPrimitive}}{{#isString}}''{{/isString}}{{#isInteger}}0{{/isInteger}}{{#isLong}}0{{/isLong}}{{#isDouble}}0.0{{/isDouble}}{{#isFloat}}0.0{{/isFloat}}{{#isBoolean}}false{{/isBoolean}}{{/returnTypeIsPrimitive}}{{^returnTypeIsPrimitive}}<String, dynamic>{}{{/returnTypeIsPrimitive}}{{/isArray}}{{/returnType}}{{^returnType}}null{{/returnType}}),
        );

        // Act & Assert - if the path parameter substitution is wrong,
        // the mock adapter won't match and the request will fail
        await api.{{operationId}}({{#allParams}}{{^-first}}, {{/-first}}{{#isPathParam}}{{{vendorExtensions.testValue}}}{{/isPathParam}}{{#isBodyParam}}{{{vendorExtensions.testValue}}}{{/isBodyParam}}{{#isQueryParam}}{{{vendorExtensions.testValue}}}{{/isQueryParam}}{{#isHeaderParam}}{{{vendorExtensions.testValue}}}{{/isHeaderParam}}{{#isFormParam}}{{{vendorExtensions.testValue}}}{{/isFormParam}}{{/allParams}});
      });
{{/hasPathParams}}
{{#hasQueryParams}}

      test('query parameters are correctly constructed', () async {
        // Arrange
        final mockSetup = createMockDio();
        final api = {{classname}}RemoteDataSourceImpl(mockSetup.dio);

        mockSetup.adapter.on{{vendorExtensions.httpMethodCapitalized}}(
          '{{path}}'{{#pathParams}}.replaceAll('{{{baseName}}}', '{{vendorExtensions.testValueRaw}}'){{/pathParams}},
          (server) => server.reply({{#returnType}}200{{/returnType}}{{^returnType}}204{{/returnType}}, {{#returnType}}{{#isArray}}<dynamic>[]{{/isArray}}{{^isArray}}{{#returnTypeIsPrimitive}}{{#isString}}''{{/isString}}{{#isInteger}}0{{/isInteger}}{{#isLong}}0{{/isLong}}{{#isDouble}}0.0{{/isDouble}}{{#isFloat}}0.0{{/isFloat}}{{#isBoolean}}false{{/isBoolean}}{{/returnTypeIsPrimitive}}{{^returnTypeIsPrimitive}}<String, dynamic>{}{{/returnTypeIsPrimitive}}{{/isArray}}{{/returnType}}{{^returnType}}null{{/returnType}}),
        );

        // Act & Assert - request succeeds with query parameters
        await api.{{operationId}}({{#allParams}}{{^-first}}, {{/-first}}{{#isPathParam}}{{{vendorExtensions.testValue}}}{{/isPathParam}}{{#isBodyParam}}{{{vendorExtensions.testValue}}}{{/isBodyParam}}{{#isQueryParam}}{{{vendorExtensions.testValue}}}{{/isQueryParam}}{{#isHeaderParam}}{{{vendorExtensions.testValue}}}{{/isHeaderParam}}{{#isFormParam}}{{{vendorExtensions.testValue}}}{{/isFormParam}}{{/allParams}});
      });
{{/hasQueryParams}}

      test('server error throws exception', () async {
        // Arrange
        final mockSetup = createMockDio();
        final api = {{classname}}RemoteDataSourceImpl(mockSetup.dio);

        mockSetup.adapter.on{{vendorExtensions.httpMethodCapitalized}}Error('{{path}}'{{#pathParams}}.replaceAll('{{{baseName}}}', '{{vendorExtensions.testValueRaw}}'){{/pathParams}}, statusCode: 500);

        // Act & Assert
        expect(
          () => api.{{operationId}}({{#allParams}}{{^-first}}, {{/-first}}{{#isPathParam}}{{{vendorExtensions.testValue}}}{{/isPathParam}}{{#isBodyParam}}{{{vendorExtensions.testValue}}}{{/isBodyParam}}{{#isQueryParam}}{{{vendorExtensions.testValue}}}{{/isQueryParam}}{{#isHeaderParam}}{{{vendorExtensions.testValue}}}{{/isHeaderParam}}{{#isFormParam}}{{{vendorExtensions.testValue}}}{{/isFormParam}}{{/allParams}}),
          throwsA(isA<DioException>()),
        );
      });
    });

{{/operation}}
  });
}
{{/operations}}
